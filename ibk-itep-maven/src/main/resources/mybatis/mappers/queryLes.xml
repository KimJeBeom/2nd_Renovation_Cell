<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="query">

	<select id="selectEduList" parameterType="EduListVo" resultType="EduListVo">
	     <![CDATA[
		/*교육목록조회*/
		SELECT 
			   EDCT_ID AS EDCTID #교육ID
			  ,EDCT_NM AS EDCTNM #교육명 
			  ,EDIN_CD AS EDINCD #교육기관코드
			  ,(SELECT EDIN_NM FROM TB_IEP_CLI001C I WHERE I.EDIN_CD = M.EDIN_CD ) AS EDINNM #교육기관명
			  ,EDCT_CLSF_CD AS EDCTCLSFCD #교육분류코드
			  ,(SELECT EDCT_CLSF_NM FROM TB_IEP_CLD001C D WHERE D.EDCT_CLSF_CD = M.EDCT_CLSF_CD ) AS EDCTCLSFNM #교육뷴류명
			  ,SNCT_TGT_YN AS SNCTTGTYN#결재대상여부 
			  ,EDCT_CON AS EDCTCON#교육내용 
			  ,INBK_EDCT_YN AS INBKEDCTYN #행내교육여부 
			  ,EGIN_APLY_YN AS EGINAPLYYN #고용보험적용여부
			  ,ONL_EDCT_YN AS ONLEDCTYN #온라인교육여부
			  ,EDCT_LEVL AS EDCTLEVL #교육수준 
			  ,USE_YN AS USEYN #사용여부
			  ,RGSN_TS AS RGSNTS#등록일시 
		FROM  TB_IEP_EDM001M M
		WHERE 1=1
	<if case="edctNm != null">
		AND   EDCT_NM LIKE '%'||#{edctNm}||'%'
	</if>
	<if case="edctClsfCd != "total"">
		AND   EDCT_CLSF_CD = #{edctClsfCd}
	</if>
	     ]]>
	</select>
	
	<select id="selectInfoCntPop" parameterType="EduInfoVo" resultType="EduInfoVo">
	     <![CDATA[
		/*교육차수정보*/
		SELECT 
			   EDCT_CNT_ID AS EDCTCNTID#교육차수ID
			  ,EDCT_STTG_YMD AS EDCTSTTGYMD#학습시작일 
			  ,EDCT_FNSH_YMD AS EDCTFNSHYMD#학습종료일
			  ,APLC_STTG_YMD AS APLCSTTGYMD#신청시작일
			  ,APLC_FNSH_YMD AS APLCFNSHYMD  #신청종료일
			  ,USE_YN AS USEYN#사용여부
			  ,RGSN_TS AS RGSNTS#등록일시 
		FROM  TB_IEP_EDC001M
		WHERE 1=1
	<if case="edctId != null">
		AND   EDCT_ID = #{edctId}
	</if>
		ORDER BY RGSN_TS ASC
	     ]]>
	</select>
	
	<insert id="insertEduApplyPopApr" parameterType="EduInfoVo">
	     <![CDATA[
		/*교육신청등록(결재)*/
		INSERT INTO TB_IEP_CLS001C(
			 EDCT_APLC_ID	#교육신청ID 
			,EDCT_CNT_ID	#교육차수ID
			,TEAM_CD	#팀코드
			,DVCD	#부서코드
			,USER_ID	#신청자ID
			,APLC_TS	#신청일시
			,APND_DAT	#첨부파일
			,DPT_ATHZ_ID	#부서승인ID 
			,DPT_ATHZ_TS	#부서승인일시
			,MNGR_ATHZ_ID	#관리자승인ID
			,MNGR_ATHZ_TS	#관리자승인일시
			,EDCT_APL_CSTG_CD	#교육신청단계코드
			,CTCR_YN	#수료여부
			,RFRC_CON	#참고
			,RTRE_CON	#반려사유
			,USE_YN	#사용여부
		) VALUES(
			,#{edctAplcId}
			,#{edctCntId}
			,#{teamCd}
			,#{dvcd}
			,#{userId}
			,NOW()
			,#{apndDat}
			,#{dptAthzId}
			,NULL
			,(SELECT USER_ID FROM TB_IEP_CMU001M ATHR_CD='GRM' WHERE @ROWNUM=1)
			,NULL
			,'APRDPM'
			,'N'
			,NULL
			,NULL
			,'Y'
		)
	     ]]>
	</insert>
	
	<insert id="insertEduApplyPopNon" parameterType="EduInfoVo">
	     <![CDATA[
		/*교육신청등록(비결재)*/
		INSERT INTO TB_IEP_CLS001C(
			 EDCT_APLC_ID	#교육신청ID 
			,EDCT_CNT_ID	#교육차수ID
			,TEAM_CD	#팀코드
			,DVCD	#부서코드
			,USER_ID	#신청자ID
			,APLC_TS	#신청일시
			,APND_DAT	#첨부파일
			,DPT_ATHZ_ID	#부서승인ID 
			,DPT_ATHZ_TS	#부서승인일시
			,MNGR_ATHZ_ID	#관리자승인ID
			,MNGR_ATHZ_TS	#관리자승인일시
			,EDCT_APL_CSTG_CD	#교육신청단계코드
			,CTCR_YN	#수료여부
			,RFRC_CON	#참고
			,RTRE_CON	#반려사유
			,USE_YN	#사용여부
		) VALUES(
			,#{edctAplcId}
			,#{edctCntId}
			,#{teamCd}
			,#{dvcd}
			,#{userId}
			,NOW()
			,#{apndDat}
			,NULL
			,NULL
			,NULL
			,NULL
			,'APRFIN'
			,'N'
			,NULL
			,NULL
			,'Y'
		)
	     ]]>
	</insert>
	
	<update id="updateEduApplyPopRe" parameterType="EduInfoVo">
	     <![CDATA[
		/*교육신청재등록*/
	UPDATE TB_IEP_EDA001M
	SET
		 APLC_TS = NOW() #신청일시
		,APND_DAT = #{apndDat} #첨부파일
	  	,DPM_ATHZ_ID = #{dpmAthzId} #부서담당자ID
		,DPM_ATHZ_TS = NULL #부서담당자승인일시
		,GRM_ATHZ_ID = (SELECT USER_ID FROM TB_IEP_CMU001M ATHR_CD='GRM' WHERE @ROWNUM=1) #그룹담당자ID
		,GRM_ATHZ_TS = NULL #그룹담당자승인일시
		,APLC_STG_CD = 'APRDEP' #교육신청단계코드
	WHERE EDCT_APLC_ID = #{edctAplcId}
	     ]]>
	</update>
	
	<insert id="InsertNewEdu" parameterType="NewEduApplyVo">
	     <![CDATA[
		/*과정개설신청정보등록*/
		INSERT INTO 
		TB_IEP_EDO001M(
			 APLC_ID	#신청ID
			,USER_ID	#사용자ID
			,APLC_TS	#신청일시
			,INBK_EDCT_YN	#행내교육여부
			,EDCT_NM	#교육명 
			,EDCT_CON	#교육내용 및 신청사유
			,EDIN_NM	#교육기관명
			,EDCT_STTG_YMD	#학습시작일 
			,EDCT_FNSH_YMD	#학습종료일 
			,APLC_STTG_YMD	#신청시작일
			,APLC_FNSH_YMD	#신청종료일 
			,EDCT_STTG_TIM	#교육시작시간 
			,EDCT_FNSH_TIM	#교육종료시간 
			,EDEX	#교육비용 
			,ONL_EDCT_YN	#온라인교육여부
			,EDCT_LEVL	#교육수준 
			,APND_DAT	#첨부파일 
			,CNFA_YN	#확인여부
			,CNFM_ID	#확인자ID
			,USE_YN	#사용여부
		) VALUES(
			 #{aplcId}
			,#{userId}
			,NOW()
			,#{inbkEdctYn}
			,#{edctNm}
			,#{edctCon}
			,#{edinNm}
			,#{edctSttgYmd}
			,#{edctFnshYmd}
			,#{aplcSttgYmd}
			,#{aplcFnshYmd}
			,#{edctSttgTim}
			,#{edctFnshTim}
			,#{edex}
			,#{onlEdctYn}
			,#{edctLevl}
			,#{apndDat}
			,NULL
			,NULL
			,'Y'
		)
	     ]]>
	</insert>
	
	<select id="selectNotice" parameterType="NoticeVo" resultType="NoticeVo">
	     <![CDATA[
		/*공지사항조회*/
		SELECT  
			   PBNS_ID AS PBNSID#공지사항ID
			  ,EDCT_CLSF_CD AS EDCTCLSFCD #교육분류코드
			  ,(SELECT EDCT_CLSF_NM FROM TB_IEP_CLD001C D WHERE D.EDCT_CLSF_CD = N.EDCT_CLSF_CD) AS EDCTCLSFNM #교육기관명
			  ,TTL AS TTL#제목 
			  ,CON AS CON#내용
			  ,RGSN_TS AS RGSNTS#등록일시 
			  ,USER_ID AS USERID#사용자ID
			  ,(SELECT USER_NM FROM TB_IEP_CMU001M U WHERE U.USER_ID = USER_ID) AS USERNM #신청자명
			  ,APND_DAT AS APNDDAT  #첨부파일
			  ,USE_YN AS USEYN 	#사용여부
		FROM  TB_IEP_BDN001M N
		WHERE 1=1
	<if case="ttl != null">
		AND   TTL LIKE '%'||#{ttl}||'%'
	</if>
		AND   USE_YN ='Y'
	     ]]>
	</select>
	
	<select id="insertNotice" parameterType="NoticeVo" resultType="String">
	     <![CDATA[
		/*공지사항등록*/
		INSERT INTO TB_IEP_BDN001M(
			 EDCT_CLSF_CD#교육분류코드
			,TTL#제목 
			,CON#내용
			,RGSN_TS#등록일시 
			,USER_ID#사용자ID
			,APND_DAT #첨부파일
			,USE_YN	#사용여부
		) VALUES(
			 #{edctClsfCd},
			,#{ttl}
			,#{con}'
			,NOW()
			,#{userId}
			,#{apndDat}
			,'Y' 
		)
	     ]]>
	</select>
	
	<update id="updateNotice" parameterType="NoticeVo">
	     <![CDATA[
		/*공지사항 수정*/
		UPDATE TB_IEP_BDN001M
		set 
		    EDCT_CLSF_CD = #{edctClsfCd} #교육분류코드
		   ,TTL = #{ttl} #제목 
		   ,CON = #{con}#내용
		   ,APND_DAT = #{apndDat} #첨부파일
		WHERE PBNS_ID =#{pbnsId}
	     ]]>
	</update>
	
	<delete id="deleteNotice" parameterType="NoticeVo">
	     <![CDATA[
		/*공지사항삭제*/
		UPDATE TB_IEP_BDN001M
		set USE_YN ='N'	#사용여부
		WHERE PBNS_ID = #{pbnsId}
	     ]]>
	</delete>
	
	<select id="selectArchList" parameterType="ArchieveVo" resultType="ArchieveVo">
	     <![CDATA[
		/*자료실조회*/
		SELECT 
			   RFLB_ID AS RFLBID#공지사항ID
			  ,EDCT_CLSF_CD AS EDCTCLSFCD#교육분류코드
			  ,(SELECT EDCT_CLSF_NM FROM TB_IEP_CLD001C D WHERE D.EDCT_CLSF_CD = EDCT_CLSF_CD) AS EDCTCLSFNM #교육기관명
			  ,TTL AS TTL#제목 
			  ,CON AS CON#내용
			  ,RGSN_TS AS RGSNTS#등록일시 
			  ,USER_ID AS USERID#사용자ID
			  ,(SELECT USER_NM FROM TB_IEP_CMU001M U WHERE U.USER_ID = USER_ID) AS USERNM #신청자명
			  ,APND_DAT AS APNDDAT  #첨부파일
			  ,USE_YN AS USEYN 	#사용여부
		FROM  TB_IEP_BDR001M
		WHERE 1=1
	<if case="ttl != null">
		AND   TTL LIKE '%'||#{ttl}||'%'
	</if>
		AND   USE_YN ='Y'
	     ]]>
	</select>
	
	<select id="insertArchieve" parameterType="ArchieveVo" resultType="String">
	     <![CDATA[
		/*자료실등록*/
		INSERT INTO TB_IEP_BDN001R(
			 EDCT_CLSF_CD #교육분류코드
			,TTL #제목 
			,CON #내용
			,RGSN_TS #등록일시 
			,USER_ID #사용자ID
			,APND_DAT #첨부파일
			,USE_YN	#사용여부
		) VALUES(
			 #{edctClsfCd},
			,#{ttl}
			,#{con}'
			,NOW()
			,#{userId}
			,#{apndDat}
			,'Y' 
		)
	     ]]>
	</select>
	
	<update id="updateArchieve" parameterType="ArchieveVo">
	     <![CDATA[
		/*자료실 수정*/
		UPDATE TB_IEP_BDR001M
		set 
		    EDCT_CLSF_CD = #{edctClsfCd} #교육분류코드
		   ,TTL = #{ttl} #제목 
		   ,CON = #{con}#내용
		   ,APND_DAT = #{apndDat} #첨부파일
		WHERE RFLB_ID = #{rflbId}
	     ]]>
	</update>
	
	<delete id="deleteArchieve" parameterType="ArchieveVo">
	     <![CDATA[
		/*자료실삭제*/
		UPDATE TB_IEP_BDR001M
		set USE_YN ='N'	#사용여부
		WHERE RFLB_ID = #{rflbId}
	     ]]>
	</delete>
	
	<select id="selectNewEduInfoPop" parameterType="EduInfoVo" resultType="EduInfoVo">
	     <![CDATA[
		/*교육상세팝업*/
		SELECT
		 	   M.EDCT_NM AS EDCTNM#교육명 
			  ,M.EDCT_CON AS EDCTCON	#교육내용 
			  ,C.EDCT_STTG_TIM AS EDCTSTTGTIM	#교육시작시간
			  ,C.EDCT_FNSH_TIM AS EDCTFNSHTIM	#교육종료시간
		FROM
			   TB_IEP_EDC001M C #교육차수
			  ,TB_IEP_EDM001M M #교육메인
		WHERE 1=1
		AND   C.EDCT_ID	= M.EDCT_ID
		AND   M.EDCT_NM = #{edctNm}
	     ]]>
	</select>
	
	<select id="selectNewEduInfoCntPop" parameterType="EduInfoVo" resultType="EduInfoVo">
	     <![CDATA[
		/*교육상세팝업(차수)*/
		SELECT 
			   EDCT_APLC_ID AS EDCTAPLCID	#교육신청ID 
			  ,TEAM_CD AS TEAMCD #팀코드
			  ,DVCD AS DVCD #부서코드
			  ,(SELECT BRNM FROM TB_IEP_CMB001M C WHERE C.BRCD = A.TEAM_CD) AS BRNM	#팀명
			  ,(SELECT BRNM FROM TB_IEP_CMB001M C WHERE C.BRCD = A.DVCD) AS BRNM	#부서명
			  ,USER_ID AS USERID	#신청자ID
			  ,(SELECT USER_NM FROM TB_IEP_CMU001M U WHERE U.USER_ID = A.USER_ID)  AS USERNM#신청자명
		FROM  TB_IEP_EDA001M A
		WHERE 1=1
		AND   EDCT_CNT_ID =#{edctCntId} 	#교육차수ID
	     ]]>
	</select>


</mapper>